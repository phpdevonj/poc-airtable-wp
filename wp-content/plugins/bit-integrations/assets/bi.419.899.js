var K=Object.defineProperty;var O=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var V=(e,n,s)=>n in e?K(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,u=(e,n)=>{for(var s in n||(n={}))G.call(n,s)&&V(e,s,n[s]);if(O)for(var s of O(n))J.call(n,s)&&V(e,s,n[s]);return e};import{r as U,j as t,L as E,d as W}from"./main-149.js";import{q as P,_ as a,f as T,p as y,H as z,m as Q,n as X,J as Y}from"./bi.738.82.js";import{g as $,a as S,r as D,b as Z}from"./bi.265.898.js";const B=(e,n,s)=>{const l=u({},n);l.field_map.splice(e,0,{}),s(u({},l))},L=(e,n,s)=>{const l=u({},n);l.field_map.length>1&&l.field_map.splice(e,1),s(u({},l))},q=(e,n,s,l)=>{const d=u({},s);d.field_map[n][e.target.name]=e.target.value,e.target.value==="custom"&&(d.field_map[n].customValue=""),e.target.value==="customFieldKey"&&(d.field_map[n].customFieldKey=""),l(u({},d))},x=(e,n,s,l,d)=>{const o=u({},s);o.field_map[n][d]=e.target.value,l(u({},o))};function M({perfexCRMConf:e,setPerfexCRMConf:n,loading:s,setLoading:l}){var v,m,w,F,c,j;const[d,o]=U.useState({show:!1,action:()=>{}}),r=(i,g)=>{var k,I,p,A,_,H;const b=u({},e);g==="direction"?(k=i.target)!=null&&k.checked?b.actions.direction=!0:(o({show:!1}),delete b.actions.direction):g==="contactIsPrimary"?(I=i.target)!=null&&I.checked?b.actions.contactIsPrimary=!0:delete b.actions.contactIsPrimary:g==="permission"?(p=i.target)!=null&&p.checked?(b.permissions=[{id:1,name:"Invoices permission"},{id:2,name:"Estimates permission"},{id:3,name:"Contracts permission"},{id:4,name:"Proposals permission"},{id:5,name:"Support permission"},{id:6,name:"Projects permission"}],b.actions.permission=!0):(o({show:!1}),delete b.actions.permission):g==="leadIsPublic"?(A=i.target)!=null&&A.checked?b.actions.leadIsPublic=!0:delete b.actions.leadIsPublic:g==="contactedToday"?(_=i.target)!=null&&_.checked?b.actions.contactedToday=!0:delete b.actions.contactedToday:g==="projectMembers"&&((H=i.target)!=null&&H.checked?($(b,n,s,l),b.actions.projectMembers=!0):delete b.actions.projectMembers),o({show:g}),n(u({},b))},h=()=>{o({show:!1})},N=(i,g)=>{const b=u({},e);b[g]=i,n(u({},b))};return t.jsxs("div",{className:"pos-rel d-flx flx-wrp",children:[e.actionName==="contact"&&t.jsx(P,{checked:(e==null?void 0:e.selectedDirection)||!1,onChange:i=>r(i,"direction"),className:"wdt-200 mt-4 mr-2",value:"direction",title:a("Add Direction","bit - integrations"),subTitle:a("Add Direction")}),e.actionName==="contact"&&t.jsx(P,{checked:((v=e==null?void 0:e.selectedPermission)==null?void 0:v.length)||!1,onChange:i=>r(i,"permission"),className:"wdt-200 mt-4 mr-2",value:"permission",title:a("Add Permissions","bit - integrations"),subTitle:a("Add Permissions for this contact")}),e.actionName==="contact"&&t.jsx(P,{checked:((m=e.actions)==null?void 0:m.contactIsPrimary)||!1,onChange:i=>r(i,"contactIsPrimary"),className:"wdt-200 mt-4 mr-2",value:"contactIsPrimary",title:a("Is it Primary Contact?","bit-integrations"),subTitle:a("Is it Primary Contact?","bit-integrations")}),e.actionName==="lead"&&t.jsx(P,{checked:((w=e.actions)==null?void 0:w.leadIsPublic)||!1,onChange:i=>r(i,"leadIsPublic"),className:"wdt-200 mt-4 mr-2",value:"leadIsPublic",title:a("Public","bit-integrations"),subTitle:a("Is it Public?","bit-integrations")}),e.actionName==="lead"&&t.jsx(P,{checked:((F=e.actions)==null?void 0:F.contactedToday)||!1,onChange:i=>r(i,"contactedToday"),className:"wdt-200 mt-4 mr-2",value:"contactedToday",title:a("Contacted Today","bit-integrations"),subTitle:a("Contacted Today","bit-integrations")}),e.actionName==="project"&&t.jsx(P,{checked:(e==null?void 0:e.selectedProjectMembers)||!1,onChange:i=>r(i,"projectMembers"),className:"wdt-200 mt-4 mr-2",value:"projectMembers",title:a("Add Project Members","bit-integrations"),subTitle:a("Add Project Members","bit-integrations")}),t.jsxs(T,{className:"custom-conf-mdl",mainMdlCls:"o-v",btnClass:"blue",btnTxt:a("Ok","bit-integrations"),show:d.show==="direction",close:h,action:h,title:a("Direction","bit-integrations"),children:[t.jsx("div",{className:"btcd-hr mt-2 mb-2"}),t.jsx("div",{className:"mt-2",children:a("Select Direction","bit-integrations")}),t.jsx("div",{className:"flx flx-between mt-2",children:t.jsx(y,{options:["rtl","ltr"].map(i=>({label:i,value:i})),className:"msl-wrp-options",defaultValue:e==null?void 0:e.selectedDirection,onChange:i=>N(i,"selectedDirection"),singleSelect:!0,closeOnSelect:!0})})]}),t.jsxs(T,{className:"custom-conf-mdl",mainMdlCls:"o-v",btnClass:"blue",btnTxt:a("Ok","bit-integrations"),show:d.show==="permission",close:h,action:h,title:a("Add Permission","bit-integrations"),children:[t.jsx("div",{className:"btcd-hr mt-2 mb-2"}),t.jsx("div",{className:"mt-2",children:a("Select Permission","bit-integrations")}),t.jsx("div",{className:"flx flx-between mt-2",children:t.jsx(y,{options:(c=e==null?void 0:e.permissions)==null?void 0:c.map(i=>({label:i.name,value:i.id.toString()})),className:"msl-wrp-options",defaultValue:e==null?void 0:e.selectedPermission,onChange:i=>N(i,"selectedPermission")})})]}),t.jsxs(T,{className:"custom-conf-mdl",mainMdlCls:"o-v",btnClass:"blue",btnTxt:a("Ok","bit-integrations"),show:d.show==="projectMembers",close:h,action:h,title:a("Add Project Members","bit-integrations"),children:[t.jsx("div",{className:"btcd-hr mt-2 mb-2"}),t.jsx("div",{className:"mt-2",children:a("Select Project Member","bit-integrations")}),s.staffs?t.jsx(E,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:45,transform:"scale(0.5)"}}):t.jsxs("div",{className:"flx flx-between mt-2",children:[t.jsx(y,{options:(j=e==null?void 0:e.staffs)==null?void 0:j.map(i=>({label:i.name,value:i.id.toString()})),className:"msl-wrp-options",defaultValue:e==null?void 0:e.selectedProjectMembers,onChange:i=>N(i,"selectedProjectMembers")}),t.jsx("button",{onClick:()=>$(e,n,s,l),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`${a("Refresh Project Members","bit-integrations")}'`},type:"button",children:"↻"})]})]})]})}function R({field:e,index:n,conf:s,setConf:l,fieldValue:d,fieldLabel:o,className:r}){return t.jsx(z,{onChange:h=>x(h,n,s,l,d),label:a(o,"bit-integrations"),className:r,type:"text",value:e[d],placeholder:a(o,"bit-integrations")})}function f({i:e,formFields:n,field:s,perfexCRMConf:l,setPerfexCRMConf:d}){var v;const o=(l==null?void 0:l.perfexCRMFields)&&(l==null?void 0:l.perfexCRMFields.filter(m=>m.required===!0))||[],r=(l==null?void 0:l.perfexCRMFields)&&(l==null?void 0:l.perfexCRMFields.filter(m=>m.required===!1))||[],h=W(Q),{isPro:N}=h;return t.jsx("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:t.jsxs("div",{className:"pos-rel flx",children:[t.jsxs("div",{className:"flx integ-fld-wrp",children:[t.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:s.formField||"",onChange:m=>q(m,e,l,d),children:[t.jsx("option",{value:"",children:a("Select Field","bit-integrations")}),t.jsx("optgroup",{label:"Form Fields",children:n==null?void 0:n.map(m=>t.jsx("option",{value:m.name,children:m.label},`ff-rm-${m.name}`))}),t.jsx("option",{value:"custom",children:a("Custom...","bit-integrations")}),t.jsx("optgroup",{label:`General Smart Codes ${N?"":"(PRO)"}`,children:N&&((v=X)==null?void 0:v.map(m=>t.jsx("option",{value:m.name,children:m.label},`ff-rm-${m.name}`)))})]}),s.formField==="custom"&&t.jsx(R,{field:s,index:e,conf:l,setConf:d,fieldValue:"customValue",fieldLabel:"Custom Value",className:"mr-2"}),t.jsxs("select",{className:"btcd-paper-inp",disabled:e<o.length,name:"perfexCRMFormField",value:e<o.length?o[e].key||"":s.perfexCRMFormField||"",onChange:m=>q(m,e,l,d),children:[t.jsx("option",{value:"",children:a("Select Field","bit-integrations")}),e<o.length?t.jsx("option",{value:o[e].key,children:o[e].label},o[e].key):r.map(({key:m,label:w})=>t.jsx("option",{value:m,children:w},m))]})]}),e>=o.length&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>B(e,l,d),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),t.jsx("button",{onClick:()=>L(e,l,d),className:"icn-btn sh-sm ml-1",type:"button","aria-label":"btn",children:t.jsx("span",{className:"btcd-icn icn-trash-2"})})]})]})})}function at({formFields:e,handleInput:n,perfexCRMConf:s,setPerfexCRMConf:l,loading:d,setLoading:o,isLoading:r,setIsLoading:h,setSnackbar:N}){var w,F;const v=c=>{l(j=>Y(j,i=>{const{name:g}=c.target;c.target.value!==""?(i.actionName=c.target.value,(c.target.value==="contact"||c.target.value==="lead")&&S(i,l,d,o),c.target.value==="project"&&(i.billingTypes=[{id:1,name:"Fixed Rate"},{id:2,name:"Project Hours"},{id:3,name:"Task Hours"}],i.projectStatus=[{id:2,name:"In Progress"},{id:3,name:"On Hold"},{id:4,name:"Finished"},{id:5,name:"Cancelled"}]),D(i,l,h,N)):(delete i[g],delete i.actionId)}))},m=(c,j)=>{const i=u({},s);i[j]=c,j==="selectedProjectType"&&c==="customer"?S(s,l,d,o):j==="selectedProjectType"&&c==="lead"&&Z(s,l,d,o),l(u({},i))};return t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("b",{className:"wdt-200 d-in-b",children:a("Select Action:","bit-integrations")}),t.jsxs("select",{onChange:v,name:"actionName",value:s.actionName,className:"btcd-paper-inp w-5",children:[t.jsx("option",{value:"",children:a("Select an action","bit-integrations")}),t.jsx("option",{value:"customer","data-action_name":"customer",children:a("Create Customer","bit-integrations")}),t.jsx("option",{value:"contact","data-action_name":"contact",children:a("Create Contact","bit-integrations")}),t.jsx("option",{value:"lead","data-action_name":"lead",children:a("Create Lead","bit-integrations")}),t.jsx("option",{value:"project","data-action_name":"project",children:a("Create project","bit-integrations")})]}),t.jsx("br",{}),t.jsx("br",{}),s.actionName==="project"&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:a("Project Status:","bit-integrations")}),t.jsx(y,{options:s==null?void 0:s.projectStatus.map(c=>({label:c.name,value:c.id.toString()})),className:"msl-wrp-options dropdown-custom-width",defaultValue:s==null?void 0:s.selectedProjectStatus,onChange:c=>m(c,"selectedProjectStatus"),disabled:r,singleSelect:!0,closeOnSelect:!0})]})]}),s.actionName==="project"&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:a("Project Related With:","bit-integrations")}),t.jsx(y,{options:["customer","lead"].map(c=>({label:c.charAt(0).toUpperCase()+c.slice(1),value:c})),className:"msl-wrp-options dropdown-custom-width",defaultValue:s==null?void 0:s.selectedProjectType,onChange:c=>m(c,"selectedProjectType"),disabled:r,singleSelect:!0,closeOnSelect:!0})]})]}),(s.actionName==="contact"||s.actionName==="lead"||s.actionName==="project")&&(s==null?void 0:s.customers)&&!d.customers&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:a("Select Customer:","bit-integrations")}),t.jsx(y,{options:(w=s==null?void 0:s.customers)==null?void 0:w.map(c=>({label:c.name,value:c.id.toString()})),className:"msl-wrp-options dropdown-custom-width",defaultValue:s==null?void 0:s.selectedCustomer,onChange:c=>m(c,"selectedCustomer"),disabled:d.customers,singleSelect:!0,closeOnSelect:!0}),t.jsx("button",{onClick:()=>S(s,l,d,o),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${a("Refresh Customers","bit-integrations")}'`},type:"button",disabled:d.customers,children:"↻"})]})]}),s.actionName==="project"&&(s==null?void 0:s.billingTypes)&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:a("Select Billing Type:","bit-integrations")}),t.jsx(y,{options:(F=s==null?void 0:s.billingTypes)==null?void 0:F.map(c=>({label:c.name,value:c.id.toString()})),className:"msl-wrp-options dropdown-custom-width",defaultValue:s==null?void 0:s.selectedbillingType,onChange:c=>m(c,"selectedbillingType"),disabled:r,singleSelect:!0,closeOnSelect:!0})]})]}),s.actionName==="project"&&(s==null?void 0:s.selectedbillingType)==="1"&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:a("Total Rate:","bit-integrations")}),t.jsx("input",{className:"btcd-paper-inp w-5 mt-1",onChange:c=>m(c.target.value,"totalRate"),name:"totalRate",value:s.totalRate||" ",type:"text",placeholder:a("Total Rate...","bit-integrations"),disabled:r})]})]}),s.actionName==="project"&&(s==null?void 0:s.selectedbillingType)==="2"&&t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:a("Rate Per Hour:","bit-integrations")}),t.jsx("input",{className:"btcd-paper-inp w-5 mt-1",onChange:c=>m(c.target.value,"ratePerHour"),name:"ratePerHour",value:s.ratePerHour||" ",type:"text",placeholder:a("Rate Per Hour...","bit-integrations"),disabled:r})]})]}),(r||d.customers||d.leads)&&t.jsx(E,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),s.actionName&&!r&&t.jsxs("div",{children:[t.jsx("br",{}),t.jsxs("div",{className:"mt-5",children:[t.jsx("b",{className:"wdt-100",children:a("Field Map","bit-integrations")}),t.jsx("button",{onClick:()=>D(s,l,h,N),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${a("Refresh Custom Fields","bit-integrations")}'`},type:"button",disabled:r,children:"↻"})]}),t.jsx("br",{}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:a("Form Fields","bit-integrations")})}),t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:a("PerfexCRM Fields","bit-integrations")})})]}),s==null?void 0:s.field_map.map((c,j)=>t.jsx(f,{i:j,field:c,perfexCRMConf:s,formFields:e,setPerfexCRMConf:l,setSnackbar:N},`rp-m-${j+9}`)),t.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:t.jsx("button",{onClick:()=>B(s.field_map.length,s,l),className:"icn-btn sh-sm",type:"button",children:"+"})}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("div",{className:"mt-4",children:t.jsx("b",{className:"wdt-100",children:a("Actions","bit-integrations")})}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsx(M,{perfexCRMConf:s,setPerfexCRMConf:l,formFields:e,loading:d,setLoading:o})]})]})}export{at as P};
