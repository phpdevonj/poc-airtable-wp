var A=Object.defineProperty;var P=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var q=(a,i,d)=>i in a?A(a,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[i]=d,r=(a,i)=>{for(var d in i||(i={}))O.call(i,d)&&q(a,d,i[d]);if(P)for(var d of P(i))x.call(i,d)&&q(a,d,i[d]);return a};import{_ as o,c as u,d as z,t as g}from"./bi.738.82.js";const K=(a,i,d,s,l,e,t,n,m,c)=>{let f=r({},d);if(i===0){if(n){const h=r({},m);h[a.target.name]="",c(r({},h))}a.target.value!==""?a.target.name!=="module"?f.moduleData[a.target.name]=parseInt(a.target.value):(f.moduleData={},f.moduleData[a.target.name]=a.target.value):delete f.moduleData[a.target.name]}else f.relatedlists||(f.relatedlists=[]),a.target.value!==""?a.target.name!=="module"?f.relatedlists[i-1][a.target.name]=parseInt(a.target.value):(f.relatedlists[i-1].moduleData={},f.relatedlists[i-1][a.target.name]=a.target.value):delete f.relatedlists[i-1][a.target.name];switch(a.target.name){case"module":f=M(i,l,f,s,e,t);break}s(r({},f))},B=(a,i)=>{i(a)},M=(a,i,d,s,l,e)=>{var m,c,f,h,y,F,w,p;const t=r({},d);t.relatedlists[a-1]||(t.relatedlists[a-1]={});const n=a===0?t.moduleData.module:t.relatedlists[a-1].module;return a===0?(t.actions={},t.field_map=[{formField:"",pipeDriveFormField:""}],t.relatedlists=[],["Leads","Deals","Activities","Notes"].includes(n)&&(!t.default.organizations&&N(t,s,l,e),!t.default.persons&&R(t,s,l,e)),!((c=(m=t.default.modules)==null?void 0:m[n])!=null&&c.fields)&&n!==""&&n!==void 0?setTimeout(()=>{k(n,t,s,a)},1e3):t.field_map=(h=(f=t.default.modules)==null?void 0:f[n])!=null&&h.requiredFields?_(a,t):[{formField:"",pipeDriveFormField:""}]):(t.relatedlists[a-1].actions={},t.relatedlists[a-1].field_map=[{formField:"",pipeDriveFormField:""}],!((F=(y=t.default.modules)==null?void 0:y[n])!=null&&F.fields)&&n!==""&&n!==void 0?setTimeout(()=>{k(n,t,s,a)},1e3):t.relatedlists[a-1].field_map=(p=(w=t.default.modules)==null?void 0:w[n])!=null&&p.requiredFields?_(a,t):[{formField:"",pipeDriveFormField:""}]),t},k=(a,i,d,s)=>{const l={api_key:i.api_key,module:a};u(l,"PipeDrive_refresh_fields").then(e=>{var t,n,m,c;if(e&&e.success){const f=r({},i);f.default.modules[a].fields||(f.default.modules[a].fields={}),e.data&&(f.default.modules[a].fields=e.data,s===0?f.field_map=(n=(t=f.default.modules)==null?void 0:t[a])!=null&&n.requiredFields?_(s,f):[{formField:"",pipeDriveFormField:""}]:f.relatedlists[s-1].field_map=(c=(m=f.default.modules)==null?void 0:m[a])!=null&&c.requiredFields?_(s,f):[{formField:"",pipeDriveFormField:""}]),d(r({},f))}})},N=(a,i,d,s)=>{d(!0);const l={api_key:a.api_key,type:"organizations"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){const t=r({},a);t.default.organizations||(t.default.organizations={}),e.data&&(t.default.organizations=e.data),i(r({},t)),s({show:!0,msg:o("Organizations refreshed","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?s({show:!0,msg:g(o("Organizations refresh failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):s({show:!0,msg:o("Organizations refresh failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},R=(a,i,d,s)=>{d(!0);const l={api_key:a.api_key,type:"persons"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){const t=r({},a);t.default.persons||(t.default.persons={}),e.data&&(t.default.persons=e.data),i(r({},t)),s({show:!0,msg:o("Persons refreshed","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?s({show:!0,msg:g(o("Persons refresh failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):s({show:!0,msg:o("Persons refresh failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},E=(a,i,d,s)=>{d(!0);const l={api_key:a.api_key,type:"users"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){const t=r({},a);t.default.owners||(t.default.owners={}),e.data&&(t.default.owners=e.data),i(r({},t)),s({show:!0,msg:o("Owners fetched successfully","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?s({show:!0,msg:g(o("Owners fetch failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):s({show:!0,msg:o("Owners fetch failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},G=(a,i,d,s)=>{d(!0);const l={api_key:a.api_key,type:"leadLabels"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){const t=r({},a);t.default.leadLabels||(t.default.leadLabels={}),e.data&&(t.default.leadLabels=e.data),i(r({},t)),s({show:!0,msg:o("Labels fetched successfully","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?s({show:!0,msg:g(o("Labels fetch failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):s({show:!0,msg:o("Labels fetch failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},H=(a,i,d,s)=>{d(!0);const l={api_key:a.api_key,type:"currencies"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){const t=r({},a);t.default.currencies||(t.default.currencies={}),e.data&&(t.default.currencies=e.data),i(r({},t)),s({show:!0,msg:o("Currencies fetched successfully","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?s({show:!0,msg:g(o("Currencies fetch failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):s({show:!0,msg:o("Currencies fetch failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},J=(a,i,d,s)=>{d(!0);const l={api_key:a.api_key,type:"stages"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){const t=r({},a);t.default.stages||(t.default.stages={}),e.data&&(t.default.stages=e.data),i(r({},t)),s({show:!0,msg:o("Stages fetched successfully","bit-integrations")})}else e&&e.data&&e.data.data||!e.success&&typeof e.data=="string"?s({show:!0,msg:g(o("Stages fetch failed Cause: %s. please try again","bit-integrations"),e.data.data||e.data)}):s({show:!0,msg:o("Stages fetch failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},_=(a,i)=>{var l,e,t,n;const d=a===0?i.moduleData.module:i.relatedlists[a-1].module,s=(n=(t=(e=(l=i==null?void 0:i.default)==null?void 0:l.modules)==null?void 0:e[d])==null?void 0:t.fields)==null?void 0:n.filter(m=>m.required===!0);return(s==null?void 0:s.length)>0?s.map(m=>({formField:"",pipeDriveFormField:m.key})):[{formField:"",pipeDriveFormField:""}]},Q=a=>{const i=a!=null&&a.field_map?a.field_map.filter(s=>{var l,e,t,n;return!s.formField&&s.pipeDriveFormField&&((n=(t=(e=(l=a==null?void 0:a.default)==null?void 0:l.modules)==null?void 0:e[a.moduleData.module])==null?void 0:t.requiredFields)==null?void 0:n.indexOf(s.pipeDriveFormField))!==-1}):[],d=a.relatedlists.map(s=>s.field_map.filter(l=>!l.formField&&l.pipeDriveFormField));return!(i.length>0||d.some(s=>s.length))},U=a=>{var i,d,s,l,e;return!(((i=a.moduleData)==null?void 0:i.module)!==""&&((l=(s=a.default.modules)==null?void 0:s[(d=a==null?void 0:a.moduleData)==null?void 0:d.module])!=null&&l.required)&&["Leads","Deals","Activities","Notes"].includes(a.moduleData.module)&&a.moduleData.organization_id===void 0&&((e=a.moduleData)==null?void 0:e.person_id)===void 0)},V=(a,i,d,s)=>{if(!a.api_key){i({api_key:a.api_key?"":o("Api Key can't be empty","bit-integrations")});return}i({}),s(!0);const l={api_key:a.api_key,type:"persons"};u(l,"PipeDrive_fetch_meta_data").then(e=>{if(e&&e.success){d(!0),s(!1),z.success(o("Authorized successfully","bit-integrations"));return}s(!1),z.error(o("Authorized failed","bit-integrations"))})};export{U as a,G as b,Q as c,J as d,H as e,B as f,E as g,K as h,R as i,V as j,N as r};
